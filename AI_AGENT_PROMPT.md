# USK Social - Development Prompt for AI Coding Agent

## Project Overview

You are building **USK Social**, a social network for Urban Sketchers to upload artwork, share sketches, and interact with fellow artists. The app allows users to visualize sketches on an interactive map based on their geographical locations.

## Tech Stack

- **Frontend**: React with TypeScript
- **Database**: Supabase (PostgreSQL with PostGIS for geographical data)
- **Hosting**: GitHub Pages
- **Styling**: Your choice (recommend Tailwind CSS for speed)
- **Maps**: Recommend Leaflet or Mapbox GL JS

## Database Schema (Already Set Up)

The Supabase database has been configured with the following structure:

### Tables

#### `profiles`
- Extends Supabase's `auth.users` table
- Fields: `id` (UUID, FK to auth.users), `username`, `full_name`, `avatar_url`, `bio`, `city`, `country`, `created_at`
- Users must create a profile after signing up

#### `events`
- Represents sketch meetups or gathering locations
- Fields: `id` (UUID), `title`, `description`, `event_date`, `latitude`, `longitude`, `location_name`, `city`, `country`, `created_by` (FK to profiles), `created_at`, `location` (geography point - auto-generated)
- Multiple sketches can be grouped under one event

#### `sketches`
- Main table for uploaded artwork
- Fields: `id` (UUID), `user_id` (FK to profiles), `event_id` (FK to events, **nullable**), `title`, `description`, `image_url`, `thumbnail_url`, `latitude`, `longitude`, `location_name`, `sketch_date`, `uploaded_at`, `location` (geography point - auto-generated)
- **Important**: `event_id` can be NULL - sketches don't need to be associated with an event
- Location is automatically generated from lat/lng coordinates

### Storage Buckets
- `sketches` - For uploaded artwork images (public read access)
- `avatars` - For profile pictures (public read access)

### Security (Row Level Security)
- All content is publicly readable
- Users can only create/update/delete their own sketches, events, and profiles
- Authentication required for creating content

## Project Structure Requirements

```
/src
  /components
    /auth
      - LoginForm.tsx
      - SignupForm.tsx
      - ProfileSetup.tsx
    /sketch
      - SketchUpload.tsx
      - SketchCard.tsx
      - SketchModal.tsx
    /map
      - InteractiveMap.tsx
      - EventCluster.tsx
      - SketchMarker.tsx
    /profile
      - ProfilePage.tsx
      - UserSketchGallery.tsx
    /common
      - Navbar.tsx
      - Footer.tsx
  /lib
    - supabaseClient.ts
    - types.ts
  /pages
    - Home.tsx
    - Map.tsx
    - Profile.tsx
  /hooks
    - useAuth.ts
    - useSketches.ts
    - useEvents.ts
  App.tsx
  main.tsx
```

## Core Features to Implement

### Phase 1: Authentication & Profile Setup

**TODO 1.1**: Set up Supabase client
- Create `src/lib/supabaseClient.ts`
- Initialize with environment variables
- Export typed client

**TODO 1.2**: Create authentication context
- Implement `useAuth` hook
- Handle signup, login, logout
- Manage user session state

**TODO 1.3**: Build authentication UI
- Login form with email/password
- Signup form with email/password
- Profile setup form (username, avatar upload)
- Protected routes for authenticated users

**TODO 1.4**: Profile creation flow
- After signup, prompt user to create profile
- Upload avatar to `avatars` bucket
- Insert profile record into `profiles` table
- Handle username uniqueness

### Phase 2: Sketch Upload

**TODO 2.1**: Create sketch upload component
- Form with fields: title, description, image file
- Location input (lat/lng) - can use:
  - Manual text input
  - Geolocation API (browser)
  - Map picker (click on map to set location)
- Optional event association dropdown
- Optional location name field

**TODO 2.2**: Implement file upload to Supabase Storage
- Upload image to `sketches` bucket
- File path pattern: `{user_id}/{timestamp}-{filename}`
- Generate public URL for uploaded image
- Optional: Create thumbnail (client-side resize before upload)

**TODO 2.3**: Save sketch metadata to database
- Insert record into `sketches` table
- Include: user_id, title, description, image_url, lat, lng, location_name
- Handle event_id (nullable if no event selected)
- The `location` geography point will be auto-generated by database trigger

**TODO 2.4**: Form validation
- Ensure required fields are filled
- Validate lat/lng format (decimals between -90/90 and -180/180)
- File size limits (e.g., max 10MB)
- Image format validation (jpg, png, webp)

### Phase 3: Home Page

**TODO 3.1**: Create landing page
- Hero section introducing USK Social
- Large prominent "Upload Sketch" button (for authenticated users)
- "Sign Up" / "Login" buttons for unauthenticated users
- Brief feature highlights

**TODO 3.2**: Featured meetups carousel
- Query recent events from `events` table
- Display in carousel/slider component
- Show: event title, date, location, preview of associated sketches
- Click to view event details or go to map location

**TODO 3.3**: Recent sketches feed (optional for MVP)
- Display grid of recently uploaded sketches
- Show sketch thumbnail, title, artist username
- Click to open sketch modal with full details

### Phase 4: Interactive Map Page

**TODO 4.1**: Set up map component
- Use Leaflet (with react-leaflet) or Mapbox GL JS
- Center on default location or user's location
- Implement zoom and pan controls

**TODO 4.2**: Display sketches as markers
- Query all sketches with non-null lat/lng
- Create custom markers/pins for individual sketches
- Show thumbnail on hover or in tooltip

**TODO 4.3**: Group sketches by event (clustering)
- Identify sketches that share the same event_id
- Display as a cluster/bubble on the map
- On cluster click: expand to show all sketches from that event
- Sketches float around the cluster point

**TODO 4.4**: Sketch visualization on map
- Display sketch thumbnails as markers
- On hover: enlarge thumbnail
- On click: open modal with full-size image and details

**TODO 4.5**: Map filtering (optional for MVP)
- Filter by date range
- Filter by city/region
- Search by sketch title or artist

### Phase 5: Profile Page

**TODO 5.1**: Display user information
- Show username, full name, bio, avatar
- Display city/country
- Show join date

**TODO 5.2**: User's sketch gallery
- Query all sketches by user_id
- Display in grid layout
- Show sketch thumbnail, title, date
- Click to open full view modal

**TODO 5.3**: Edit profile functionality
- Allow user to update their own profile
- Edit username, full name, bio, avatar
- Save changes to `profiles` table

**TODO 5.4**: Public profile view
- Display other users' profiles (read-only)
- Access via URL parameter (e.g., /profile/:userId)

### Phase 6: Sketch Detail Modal

**TODO 6.1**: Create modal component
- Display full-size sketch image
- Show title, description, date, location
- Display artist info (avatar, username)
- Link to artist profile

**TODO 6.2**: Sketch actions
- Edit button (only for sketch owner)
- Delete button (only for sketch owner)
- View on map button (navigate to map centered on sketch location)

**TODO 6.3**: Edit sketch functionality
- Update title, description
- Cannot change image or location after upload (for MVP)
- Save changes to `sketches` table

### Phase 7: Event Management (Optional for MVP)

**TODO 7.1**: Create event form
- Title, description, date/time
- Location (lat/lng + location name)
- Submit creates new record in `events` table

**TODO 7.2**: Event detail page
- Display event information
- Show all sketches associated with the event
- Map preview centered on event location

**TODO 7.3**: Associate sketch with event during upload
- Dropdown/search to select existing events
- Option to create new event inline

## Technical Implementation Guidelines

### Supabase Integration

**Initialize Client:**
```typescript
// src/lib/supabaseClient.ts
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient(supabaseUrl, supabaseAnonKey)
```

**Example: Upload Sketch**
```typescript
// 1. Upload image file
const fileExt = file.name.split('.').pop()
const fileName = `${Date.now()}-${Math.random()}.${fileExt}`
const filePath = `${user.id}/${fileName}`

const { error: uploadError } = await supabase.storage
  .from('sketches')
  .upload(filePath, file)

// 2. Get public URL
const { data: { publicUrl } } = supabase.storage
  .from('sketches')
  .getPublicUrl(filePath)

// 3. Insert sketch record
const { data, error } = await supabase
  .from('sketches')
  .insert({
    user_id: user.id,
    title: sketchTitle,
    description: sketchDescription,
    image_url: publicUrl,
    latitude: lat,
    longitude: lng,
    location_name: locationName,
    event_id: selectedEventId || null
  })
  .select()
  .single()
```

**Example: Query Sketches for Map**
```typescript
const { data: sketches, error } = await supabase
  .from('sketches')
  .select(`
    *,
    profiles:user_id (username, avatar_url),
    events:event_id (title, location_name)
  `)
  .not('latitude', 'is', null)
  .not('longitude', 'is', null)
```

**Example: Query User's Sketches**
```typescript
const { data: userSketches } = await supabase
  .from('sketches')
  .select('*')
  .eq('user_id', userId)
  .order('uploaded_at', { ascending: false })
```

### TypeScript Types

Create type definitions in `src/lib/types.ts`:

```typescript
export interface Profile {
  id: string
  username: string
  full_name: string | null
  avatar_url: string | null
  bio: string | null
  city: string | null
  country: string | null
  created_at: string
}

export interface Event {
  id: string
  title: string
  description: string | null
  event_date: string | null
  latitude: number
  longitude: number
  location_name: string | null
  city: string | null
  country: string | null
  created_by: string | null
  created_at: string
}

export interface Sketch {
  id: string
  user_id: string
  event_id: string | null
  title: string
  description: string | null
  image_url: string
  thumbnail_url: string | null
  latitude: number | null
  longitude: number | null
  location_name: string | null
  sketch_date: string
  uploaded_at: string
  profiles?: Profile
  events?: Event
}
```

### Authentication Pattern

```typescript
// src/hooks/useAuth.ts
import { useState, useEffect } from 'react'
import { supabase } from '@/lib/supabaseClient'
import type { User } from '@supabase/supabase-js'

export function useAuth() {
  const [user, setUser] = useState<User | null>(null)
  const [loading, setLoading] = useState(true)

  useEffect(() => {
    // Get initial session
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null)
      setLoading(false)
    })

    // Listen for auth changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null)
    })

    return () => subscription.unsubscribe()
  }, [])

  const signUp = async (email: string, password: string) => {
    const { data, error } = await supabase.auth.signUp({ email, password })
    return { data, error }
  }

  const signIn = async (email: string, password: string) => {
    const { data, error } = await supabase.auth.signInWithPassword({ email, password })
    return { data, error }
  }

  const signOut = async () => {
    const { error } = await supabase.auth.signOut()
    return { error }
  }

  return { user, loading, signUp, signIn, signOut }
}
```

### Map Implementation Suggestions

**Using Leaflet (Recommended for simplicity):**

```bash
npm install leaflet react-leaflet
npm install -D @types/leaflet
```

```typescript
import { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet'
import 'leaflet/dist/leaflet.css'

function InteractiveMap({ sketches }: { sketches: Sketch[] }) {
  return (
    <MapContainer center={[40.7589, -73.9851]} zoom={13} style={{ height: '100vh' }}>
      <TileLayer
        url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
      />
      {sketches.map((sketch) => (
        sketch.latitude && sketch.longitude && (
          <Marker key={sketch.id} position={[sketch.latitude, sketch.longitude]}>
            <Popup>
              <img src={sketch.thumbnail_url || sketch.image_url} alt={sketch.title} />
              <h3>{sketch.title}</h3>
              <p>{sketch.profiles?.username}</p>
            </Popup>
          </Marker>
        )
      ))}
    </MapContainer>
  )
}
```

**Clustering sketches by event:**
- Group sketches by `event_id` in JavaScript
- For sketches with same event_id, use the event's lat/lng as cluster center
- Use Leaflet MarkerCluster plugin or custom clustering logic

## Environment Variables

Create `.env` file:
```env
VITE_SUPABASE_URL=your-project-url
VITE_SUPABASE_ANON_KEY=your-anon-key
```

Add to `.gitignore`:
```
.env
.env.local
```

## Deployment to GitHub Pages

**TODO: Setup deployment**
1. Install: `npm install gh-pages --save-dev`
2. Add to `package.json`:
   ```json
   "homepage": "https://yourusername.github.io/usk-social",
   "scripts": {
     "predeploy": "npm run build",
     "deploy": "gh-pages -d dist"
   }
   ```
3. Update `vite.config.ts` for base path:
   ```typescript
   export default defineConfig({
     base: '/usk-social/',
     // ... rest of config
   })
   ```
4. Run: `npm run deploy`

## Testing Checklist

- [ ] User can sign up and create profile
- [ ] User can log in and log out
- [ ] User can upload a sketch with location
- [ ] User can upload a sketch without an event (event_id is null)
- [ ] Sketches appear on the map at correct locations
- [ ] Sketches grouped by event display as clusters
- [ ] User can view their profile and all their sketches
- [ ] User can edit their own sketch
- [ ] User can delete their own sketch
- [ ] User cannot edit/delete other users' sketches
- [ ] Map is performant with 50+ sketches

## Nice-to-Have Features (Post-MVP)

- Geolocation API to auto-fill user's current location
- Image compression/thumbnail generation
- Infinite scroll for sketch feeds
- Search functionality for sketches and users
- Social features: likes, comments, follows
- Event RSVP system
- Email notifications for nearby events
- Export sketch collection

## Important Notes

1. **Geography Points**: The database automatically converts lat/lng to PostGIS geography points. You don't need to handle this in the frontend - just provide latitude and longitude as decimal numbers.

2. **Event Association**: Sketches can exist independently or be part of an event. Make sure `event_id` can be null in your upload form.

3. **Image Optimization**: Consider client-side image resizing before upload to reduce storage costs and improve load times.

4. **Error Handling**: Always handle Supabase errors gracefully and show user-friendly messages.

5. **Performance**: Use pagination or infinite scroll for sketch lists. The map should load markers efficiently (consider viewport-based loading for large datasets).

6. **Mobile Responsive**: Ensure all pages work well on mobile devices, especially the map interaction.

## Getting Started

1. Set up React + TypeScript project: `npm create vite@latest usk-social -- --template react-ts`
2. Install dependencies: `npm install @supabase/supabase-js`
3. Create `.env` file with Supabase credentials
4. Initialize Supabase client
5. Start with authentication flow (Phase 1)
6. Build incrementally, testing each feature

## Questions to Consider

- Should sketch upload be a modal or separate page?
- Do you want to support multiple images per sketch in the future?
- Should events be publicly creatable or admin-only?
- What's the max file size for sketch uploads?
- Do you need sketch categories/tags?

---

**Start coding!** Focus on getting a working MVP with core functionality: auth, upload, and map display. Polish and additional features can come later.
